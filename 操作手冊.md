# RayBot 資料整合機器 - 操作與管理手冊 (v4.9.6)

## 📌 目錄
1. [系統簡介](#1-系統簡介)
2. [一般使用者指南 (LINE)](#2-一般使用者指南-line)
3. [群組管理員指南 (後台網頁)](#3-群組管理員指南-後台網頁)
4. [超級管理員指南 (Super Admin)](#4-超級管理員指南-super-admin)
5. [常見問題與故障排除](#5-常見問題與故障排除)

---

## 1. 系統簡介
本系統整合 Cloudflare Worker、D1 資料庫與 LINE Messaging API，提供班級作業管理、考試提醒與攜帶物品通知功能。支援 AI 自動判讀訊息、多層級權限管理與全域維護模式。

**主要網址：**
*   **學生作業一覽 (前端)**: `https://你的網域/?id={GroupID}`
*   **班級管理後台 (後端)**: `https://你的網域/manager?id={GroupID}`
*   **超級管理後台**: `https://你的網域/super-admin`

---

## 2. 一般使用者指南 (LINE)

### 🤖 機器人指令
在 LINE 群組中輸入以下指令：

| 指令 | 功能說明 | 備註 |
| :--- | :--- | :--- |
| `/bot start` | 初始化機器人或顯示條款 | 新群組必做 |
| `/bot agree` | 同意服務條款 | 同意後才可使用 |
| `/bot disagree` | 不同意服務條款 | **警告：將導致服務立即終止** |
| `/bot help` | 顯示指令說明清單 | |
| `/bot student` | 取得學生作業網址 | 或是 `/bot 學生` |
| `/bot manager` | 取得後台管理網址 | 或是 `/bot 後台` |
| `/bot ID` | 顯示當前群組 ID | |
| `/bot test` | 檢查系統健康度與維護狀態 | 顯示前後端與資料庫延遲 |

### 🛠️ 建立與設定群組 (僅限初始化階段)
當群組狀態為「準備設定」時：
*   **建立新群組**：輸入 `/bot newID` (若系統開啟密碼保護，需輸入 `/bot newID <密碼>`)。
*   **沿用舊設定**：輸入 `/bot <舊的GroupID>`。

### 📝 自動作業抓取
直接在群組輸入包含 **日期** 與 **科目** 的訊息，例如：
> "明天考英文單字"
> "下週三交國語習作"
> "12/25 帶水彩用具"

---

## 3. 群組管理員指南 (後台網頁)

### 🔑 登入與權限
*   **Administrator (總管理員)**：擁有最高權限，可管理作業、系統設定、成員權限。**不可被刪除或降權**。
*   **一般成員**：依據被賦予的權限進行操作 (如小老師僅能新增作業)。

### ⚙️ 系統設定
*   **科目設定**：可自訂科目名稱與關鍵字 (支援新增/刪除)。
*   **節次時間**：設定每日節次的上課/下課時間，讓機器人自動判斷 "第三節考數學"。
*   **進階設定**：
    *   **AI 智慧輔助**：開啟後可辨識模糊語意 (需 Super Admin 授權)。
    *   **審核模式**：自動發佈 / 定時審核 / 完全手動。

### 👥 成員管理
*   可新增其他管理員或小老師。
*   可勾選特定權限 (如：僅管理作業、僅管理設定)。
*   **Administrator 的名稱與密碼無法修改**。

---

## 4. 超級管理員指南 (Super Admin)

進入 `/super-admin` 並輸入 `SUPER_ADMIN_PASSWORD` 登入。

### 🛡️ 維護模式 (Maintenance)
可針對 **前端網頁** 與 **後端 API** 分別設定：
*   **啟用攔截**：開啟後使用者無法訪問。
*   **維護類型**：資料更新中 / 系統維護中...等。
*   **公告訊息**：顯示給使用者的提示文字。
*   **結束時間**：設定自動解除維護的時間。

### 👥 群組管理 (Group Management)
可查看所有已註冊的班級群組：
*   **搜尋**：支援 ID、名稱、救援碼、復原碼搜尋。
*   **⚙️ 設定**：控制個別群組是否允許使用 **AI 功能**。
*   **🔶 重置狀態**：清空該群組所有作業、成員與設定，但**保留 Administrator 綁定與 ID**。(需操作密碼)
*   **🟡 重置救援碼**：重新生成 6 位數救援碼。
*   **🔴 刪除群組**：永久刪除該群組所有資料。(需操作密碼)

### ⚙️ 全域政策設定 (Settings)
*   **新增群組權限**：
    *   **開放**：任何人皆可 `/bot newID`。
    *   **密碼保護**：需輸入正確密碼才可建立。
    *   **關閉**：禁止建立新群組。
*   **敏感操作保護**：開啟後，執行刪除/重置群組時需再次輸入密碼。

### 📜 系統日誌 (Logs)
*   紀錄所有登入、操作、錯誤訊息。
*   支援翻頁與一鍵清空。

---

## 5. 常見問題與故障排除

### Q: 機器人沒反應？
1.  檢查是否已同意條款 (`/bot agree`)。
2.  檢查 LINE Developer 後台 Webhook 是否開啟。
3.  輸入 `/bot test` 檢查 Worker 是否運作中。

### Q: 忘記後台密碼怎麼辦？
*   **一般成員**：請 Administrator 在後台重置。
*   **Administrator**：
    1.  找出 **6位數救援碼** (Super Admin 可查詢)。
    2.  在後台登入頁點擊「忘記密碼」。
    3.  輸入救援碼以重置密碼。
    4.  若有綁定 LINE，可在個人聊天室輸入 `/bot 復原碼` 查詢。

### Q: 顯示 "Unknown Action"？
代表 API 請求錯誤或程式碼版本不匹配，請重新整理網頁或聯繫開發者。
